# Create my cluster. Syntax: http://www.fig.sh/yml.html

# Simple fs share
fs:
    image: busybox
    volumes:
        - ./tmp:/opt/fsshare
up:
    image: busybox
    volumes:
        - ./tmp/files:/uploads
# Empty container which holds the data directory
data:
    build: ./docker/pybase
    volumes:
        - ./data:/data:rw

# Database server master
rdb:
    build: ./docker/rethinkdb
    command: bash /root/init.sh
    volumes_from:
         - data # Import data directory from storage container
         - fs
    ports:
        - "8888:8080" # Rdb monitoring cluster - DEBUG

# Python api server connected to Rethink DB database
api:
    build: ./docker/webapp
    #command: bash /root/security.sh
    #command: python file.py
    command: sleep 876129876
    volumes:
        - ./app:/opt/app
    working_dir: /opt/app
    volumes_from:
        - fs
        - up
    ports:
        - "5507:5000" # expose the api to the world!
        - "5346:6000" # file handling
    links:
        - rdb:db

# Web development angular pages running on a javascript server
webdev:
    build: ./docker/node
    command: sleep 123456789
    #command: /startup.sh
    volumes:
        - ./yoapp:/opt/yo
    working_dir: /opt/yo
    links:
        - api:api
        # REMOVE IN THE FUTURE?
        - rdb:db
    ports:
        - "9001:9000" # Dev server
        - "8080:3000" # Chateau admin db
        - "35729:35729" # Live reload

# # Web static angular pages
web:
    build: ./docker/gui
    command: nginx
    volumes:
        - ./staticroot:/var/www/html
        - ./yoapp/app:/var/www/html/app
        - ./yoapp/dist:/var/www/html/static
    volumes_from:
        - up
    working_dir: /opt/app
    links:
        - api:api
    ports:
        - "80:80" # Main server
