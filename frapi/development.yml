# Everything here is HTTP (not https and certificates)

##########################
## From common

# DB with no data dir, i restart every time from zero?
devdb:
    extends:
        file: common.yml
        service: rdb
# APIs in debug mode
pycode:
    extends:
        file: common.yml
        service: pycode
updata:
    extends:
        file: common.yml
        service: updata
devapi:
    extends:
        file: common.yml
        service: api
    command: python main.py
    exposes:
        - "5000"
    volumes_from:
        - pycode
    links:
        - devdb:db
devfapi:
    extends:
        file: common.yml
        service: fileapi
    command: python file.py
    exposes:
        - "6000"
    volumes_from:
        - pycode
        - updata

##########################
## PROXY
devproxy:
    extends:
        file: common.yml
        service: proxy
    ports:
        - "4321:9090" #the debug db chateau
        - "5432:7070" #the debug db monitor
    links:
        - devapi:api # i need to know the internal container which exposes api
        - devfapi:fapi
        - webdev:capi
        - devdb:rmonitor
    volumes:
        - ../docker/proxy/dev-enabled.conf:/etc/nginx/sites-enabled/development
    volumes_from:
        - updata

##########################
## Only for development?

# Db init with db, table and admin user
devdbinit:
    extends:
        file: common.yml
        service: api
    command: python devinit.py
    links:
        - devdb:db
    volumes_from:
        - pycode
# Nodejs: Database admin and dist build
webdev:
    build: ../docker/jsdev
    # environment:
    #     TESTENV: hello world
    command: chateau
    volumes:
        - ../yoapp:/opt/jsapp
    links:
        - devdb:db

##########################
provider:
    extends:
        file: common.yml
        service: api
    command: sleep 12456789
    volumes_from:
        - pycode
    ports:
        - "80:80"
